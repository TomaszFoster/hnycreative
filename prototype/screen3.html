<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/foundation.css" />
    <script src="js/vendor/modernizr.js"></script>
  </head>
  <body onload="getUserInfo()">

    <form>  
    <div class="row">
      <div class="small-7 columns">
        <!-- Business Name-->
        <div class="row">
          <div class="small-3 columns">
            <label for="bName" class="right inline">Business Name</label>
          </div>
          <div class="small-9 columns">
            <input type="text" id="bName" name="bName" placeholder="Business Name"/>
          </div>
        </div>

        <!-- Business Description-->
       <div class="row">
          <div class="small-3 columns">
          
            <label for="bDescription" class="right inline">Description</label>
          </div>
          <div class="small-9 columns">
            
              <textarea rows="3" class="right" name="bDescription" placeholder="Description"></textarea><br>
          </div>
        </div>

        <!-- Address Line 1 and 2 -->
        <div class="row">
          <div class="small-3 columns">
            <label for="bAddress" class="right inline">Address</label>
          </div>
          <div class="small-9 columns">
            <input type="text" name="bAddress" placeholder="Address Line 1"/>
            <input type="text" name="bAddress2" placeholder="Address Line 2"/>
          </div>
        </div>

        <!-- City, State and Zip-->
        <div class="row">
          <div class="small-3 columns">
            <label for="bCity" class="right inline">City, State Zip</label>
          </div>
          <div class="small-9 columns">
            <div class="row">
              <div class="small-6 columns">
                <input type="text" name="bCity" placeholder="City"/>
              </div>
              <div class="small-3 columns">
                <input type="text" name="bState" placeholder="State"/>
              </div>
              <div class="small-3 columns">
                <input type="text" name="bZip" placeholder="ZIP"/>
              </div>
            </div>
        </div>
    </div>

        <!-- Phone -->
        <div class="row">
          <div class="small-3 columns">
            <label for="bPhone" class="right inline">Phone</label>
          </div>
          <div class="small-9 columns">
            <input type="text" name="bPhone" placeholder="XXX-XXX-XXXX"/>
          </div>
      </div>

        <!-- Reward Title and Description-->
        <div class="row">
          <div class="small-3 columns">
            <label for="bReward" class="right inline">Reward Title</label>
          </div>
          <div class="small-9 columns">
            <input type="text" name="bReward" placeholder="Reward Title"/>
          </div>
      </div>
      <div class="row">
          <div class="small-3 columns">
            <label for="bRewardDetail" class="right inline">Reward Detail</label>
          </div>
          <div class="small-9 columns">
            <textarea rows="3" name="bRewardDetail" placeholder="Reward Detail"></textarea>
          </div>
      </div>

        <!-- Logo w/ Browse & Upload -->
        <div class="row">
          <div class="small-3 columns">
            <label for="bLogo" class="right inline">Upload Logo</label>
          </div>
          <div class="small-9 columns">
            <div class="row">
              <div class="small-6 columns">
                <input type="text" name="bLogo" placeholder="Logo"/>
              </div>
              <div class="small-3 columns">
                <button class="button tiny">Browse</button>
              </div>
              <div class="small-3 columns">
                <button class="button tiny">Upload</button>
              </div>
            </div>
        </div>
    </div>

        <!-- Image w/ Browse & Upload -->
        <div class="row">
          <div class="small-3 columns">
            <label for="bImage" class="right inline">Upload Image</label>
          </div>
          <div class="small-9 columns">
            <div class="row">
              <div class="small-6 columns">
                <input type="text" name="bImage" placeholder="Image"/>
              </div>
              <div class="small-3 columns">
                <button class="button tiny">Browse</button>
              </div>
              <div class="small-3 columns">
                <button class="button tiny">Upload</button>
              </div>
            </div>
        </div>
    </div>

        <!-- SOCIAL MEDIA -->
        <!-- Facebook -->
        <div class="row">
          <div class="small-3 columns">
            <label for="bFacebook" class="right inline">Facebook</label>
          </div>
          <div class="small-9 columns">
            <input type="text" name="bFacebook" placeholder="Facebook Url"/>
        </div>
    </div>

        <!-- Twitter -->
        <div class="row">
          <div class="small-3 columns">
            <label for="bTwitter" class="right inline">Twitter</label>
          </div>
          <div class="small-9 columns">
            <input type="text" name="bTwitter" placeholder="Twitter Url"/>
          </div>
        </div>

        <!-- Google+ -->
        <div class="row">
          <div class="small-3 columns">
            <label for="bG+" name="googlename" class="right inline">Google+</label>
          </div>
          <div class="small-9 columns">
            <input type="text" name="bG+" placeholder="Google+ Url"/>
          </div>
        </div>

        <!-- Yelp! -->
        <div class="row">
          <div class="small-3 columns">
            <label for="bYelp" class="right inline">Yelp</label>
          </div>
          <div class="small-9 columns">
            <input type="text" name="bYelp" placeholder="Yelp! Url"/>
          </div>
        </div>

        <!-- Pinterest -->
        <div class="row">
          <div class="small-3 columns">
            <label for="bPinterest" class="right inline">Pinterest</label>
          </div>
          <div class="small-9 columns">
            <input type="text" name="bPinterest" placeholder="Pinterest Url"/>
          </div>
        </div>

        <!-- Instagram -->
        <div class="row">
          <div class="small-3 columns">
            <label for="bInstagram" class="right inline">Instagram</label>
          </div>
          <div class="small-9 columns">
          
            <input type="text" name="bInstagram" name="bInstagram" placeholder="Instagram Url"/></label>

          </div>
        </div>
      </div>

      <div class="small-5 columns">
        <!-- Category - Dropdown -->
        <div class="row">
          <div class="small-3 columns">
            <label for="bCategory" class="right inline">Category</label>
          </div>
          <div class="small-9 columns">
            <select name="bCategory">
              <option></option>
              <option value="opt1">Option1</option>
              <option value="opt2">Option2</option>
              <option value="opt3">Option3</option>
              <option value="opt4">Option4</option>
            </select>
        </div>
    </div>
        <!-- Sub Cat 1 -->
        <div class="row">
          <div class="small-3 columns">
            <label for="bSubCat1" class="right inline">Sub Cat 1</label>
          </div>
          <div class="small-9 columns">
            <select name="bSubCat1">
              <option></option>
              <option value="opt1">Option1</option>
              <option value="opt2">Option2</option>
              <option value="opt3">Option3</option>
              <option value="opt4">Option4</option>
            </select>
        </div>
    </div>
        <!-- Sub Cat 2 -->
        <div class="row">
          <div class="small-3 columns">
            <label for="bSubCat2" class="right inline">Sub Cat 2</label>
          </div>
          <div class="small-9 columns">
            <select name="bSubCat2">
              <option></option>
              <option value="opt1">Option1</option>
              <option value="opt2">Option2</option>
              <option value="opt3">Option3</option>
              <option value="opt4">Option4</option>
            </select>
        </div>
    </div>
        <!-- Sub Cat 3 -->
        <div class="row">
          <div class="small-3 columns">
            <label for="bSubCat3" class="right inline">Sub Cat 3</label>
          </div>
          <div class="small-9 columns">
            <select name="bSubCat3">
              <option></option>
              <option value="opt1">Option1</option>
              <option value="opt2">Option2</option>
              <option value="opt3">Option3</option>
              <option value="opt4">Option4</option>
            </select>
        </div>
    </div>

        <!-- Profile Categories - 3 Dropdowns -->
        <div class="row">
          <div class="small-3 columns">
            <label for="bProfile1" class="right inline">Profile 1</label>
          </div>
          <div class="small-9 columns">
            <select name="bProfile1">
              <option></option>
              <option value="opt1">Option1</option>
              <option value="opt2">Option2</option>
              <option value="opt3">Option3</option>
              <option value="opt4">Option4</option>
            </select>
        </div>
    </div>

        <div class="row">
          <div class="small-3 columns">
            <label for="bProfile2" class="right inline">Profile 2</label>
          </div>
          <div class="small-9 columns">
            <select name="bProfile2">
              <option></option>
              <option value="opt1">Option1</option>
              <option value="opt2">Option2</option>
              <option value="opt3">Option3</option>
              <option value="opt4">Option4</option>
            </select>
        </div>
    </div>

        <div class="row">
          <div class="small-3 columns">
            <label for="bProfile3" class="right inline">Profile 3</label>
          </div>
          <div class="small-9 columns">
            <select name="bProfile3">
              <option></option>
              <option value="opt1">Option1</option>
              <option value="opt2">Option2</option>
              <option value="opt3">Option3</option>
              <option value="opt4">Option4</option>
            </select>
        </div>
    </div>

        <!-- Hours of Operation - 7 Double Dropdowns with :30 min increments -->

        <!-- Dynamically generate all lists of hours, will make it much easier to change later -->
        <script type="text/javascript">
          var dayOfWeek;
          for (var j=0; j<7;j++){
            switch (j)
            {
            case 0:
                dayOfWeek = "Sunday";
                break;
            case 1:
              dayOfWeek = "Monday";
              break;
            case 2:
              dayOfWeek = "Tuesday";
              break;
            case 3:
              dayOfWeek = "Wednesday";
              break;
            case 4:
              dayOfWeek = "Thursday";
              break;
            case 5:
              dayOfWeek = "Friday";
              break;
            case 6:
              dayOfWeek = "Saturday";
              break;
            }
              document.write("<div class='row'>"); /* close row */
              document.write("<div class='small-3 columns'>");
                document.write("<label class='right inline'>"+dayOfWeek+"</label>");
              document.write("</div>");
              document.write("<div class='small-9 columns'>");
                document.write("<div class='row'>");

            for (var k=1; k<3;k++){
              var openTime = 4;
              var increment = 30;
              document.write("<div class='small-6 columns'>");
              if (k==1){
                document.write("<select class='openTime' name='"+ dayOfWeek+k+"'>");
                document.write("<option value='closed'>closed</option>");
              }else{
                document.write("<select class='closeTime' name='"+ dayOfWeek+k+"'>");
                document.write("<option value=''></option>");
              }
              for (var i=1; i <=8; i++)
              {
                openTime+=1;
                document.write("<option value='"+openTime+"00'>" + openTime + ":00 AM</option>");
                document.write("<option value='"+openTime+increment+"'>" + openTime + ":" + increment + " AM</option>");
              }
              var openTime = 1;
              for (var i=1; i <=10; i++)
              {
                var displayTime = openTime + 12;
                document.write("<option value='"+displayTime+"00'>" + openTime + ":00 PM</option>");
                document.write("<option value='"+displayTime+""+increment+"'>" + openTime + ":" + increment + " PM</option>");
                openTime+=1;
              }
              document.write("</select>");
              document.write("</div>"); /* close small-6 div */
              
            }
            document.write("</div>"); /* close row */
            document.write("</div>"); /* close small-9 */
            document.write("</div>"); /* close row */
          }
        </script>


        <!-- HERE IS WHERE THE DIFFERENCES ARE FOR THE ADMIN PAGE -->
        <div class="panel">
          <!-- Last Visit -->
          	<div class="row">
	        	<div class="small-3 columns">
        			<label for="bLastVisit" class="right inline">Last Visit</label>
        		</div>
        		<div class="small-9 columns">
          			<input type="text" name="bLastVisit"/>
          		</div>
        	</div>

          
          <!-- Next Visit -->
          <div class="row">
	        	<div class="small-3 columns">
        			<label for="bNextVisit" class="right inline">Next Visit</label>
        		</div>
        		<div class="small-9 columns">
          			<input type="text" name="bNextVisit"/>
          		</div>
        	</div>
          
          <!-- QR Count -->
          	<div class="row">
	        	<div class="small-3 columns">
        			<label for="bQRCount" class="right inline"># of QR's</label>
        		</div>
        		<div class="small-9 columns">
          			<input type="text" name="bQRCount"/>
          		</div>
        	</div>
          
          
          	<!-- Admin Notes -->
         	<div class="row">
	        	<div class="small-3 columns">
        			<label for="bNotes" class="right inline">Notes</label>
        		</div>
        		<div class="small-9 columns">
          			<input type="text" name="bNotes"/>
          		</div>
        	</div>

        </div> <!-- END PANEL -->
      </div>

      
    </div>
    </form>

    <!-- Save Button -->
    <button class="button" onclick="sendAllVariables()">Save</button>
    
    <script src="js/vendor/jquery.js"></script>
    <script src="js/foundation.min.js"></script>
    <script>
      $(document).foundation();

      /* 
      * Here is the code to save the last updated date to localstorage
      * We save the date in YYYYMMDD format as it's the easiest to compare to
      */

      //instantiate a new date object
      var d = new Date();
      // get date in YYYYMMDD format
      var fullDate = (d.getFullYear()*10000)+((d.getMonth()+1)*100)+d.getDate();
      //save to localstorage as lastUpdated
      window.localStorage.setItem( 'lastUpdated', JSON.stringify(fullDate));
      //output localstorage contents to console
      //console.log(window.localStorage);

      /*
      * End of code to save last updated date
      */

      /*
      * Function to send all the variables on the form once button is clicked
      */
      function sendAllVariables(){

        /* 
        * this array is needed to get the values of all the form inputs given an
        * identifier input
        */
        $.fn.serializeObject = function()
        {
            var o = {};
            var a = this.serializeArray();
            $.each(a, function() {
                if (o[this.name] !== undefined) {
                    if (!o[this.name].push) {
                        o[this.name] = [o[this.name]];
                    }
                    o[this.name].push(this.value || '');
                } else {
                    o[this.name] = this.value || '';
                }
            });
            return o;
        };

        // use previous function to read all form elements
        var formData = $('form').serializeObject();
        /* now we send the form data as an ajax packet
        * to a php server which processes the data on the back end
        */
        $.ajax({
            url: "http://localhost/index3.php",
            type: "POST",
            data: formData,
            dataType: "json",
            success: function (jsonStr) {
                console.log(jsonStr);
            },
            error: function(response) {
                console.log(response);
                console.log('Test failed!');                  
            }
        });  
      }

      /*
      * Get all the information about the business to populate the form
      * send last updated timestamp from localstorage to compare and see
      * which business information we need to get back
      */
      function getUserInfo(){
        $.ajax({
            url: "http://localhost/getBusinessInfo.php",
            type: "GET",
            data: {'lastUpdated':window.localStorage['lastUpdated']},
            dataType: "json",
            success: function (response) {
                console.log(response);
                populateInfo(response);
            },
            error: function(response) {
                console.log(response);
                console.log('Test failed!');                  
            }
        }); 
      }

      /* 
      * populate the form with business information for a particular business
      * in this case being one with storeID 11782
      */
      function populateInfo(incomingJson){
        jsonInfo = incomingJson['11782'];
        for(a in jsonInfo){
          $("input[name='"+a+"']").val(jsonInfo[a]);
          $("textarea[name='bDescription']").val(jsonInfo['bDescription']);
          $("textarea[name='bRewardDetail']").val(jsonInfo['bRewardDetail']);
          $('select[name="'+a+'"] option[value="'+jsonInfo[a]+'"]').prop('selected', true);
        }
        console.log("success!");
      }
    </script>
  </body>
</html>
