<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/foundation.css" />
    <link rel="stylesheet" href="css/style.css" />
    <script src="js/vendor/modernizr.js"></script>
    
  </head>
  <body>

    <div class="row">
      <div class="small-6 columns">
        <!-- New Business / QR / Sort Button -->
        <a href="screen3.html" class="button small" id="newBusiness">+ New Business</a>
        <button href="#" class="button small" id="printQR" onclick="sendQR()">Print QR</button>
      </div>
    </div>
        
        <div class="row">  
          <div class="small-12 columns">
            <table>
              <thead>
                <tr>
                  <th width="300" colspan="2"><a onclick="repopulate('bName')">Store</a></th>
                  <th width="150"><a onclick="repopulate('bCity')">City</a></th>
                  <th width="100"><a onclick="repopulate('bStatus')">Status</a></th>
                  <th width="150"><a onclick="repopulate('bLastVisit')">Last Visit</a></th>
                  <th width="150"><a onclick="repopulate('bNextVisit')">Next Visit</a></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td width="90%">
                    <p class="bName"></p>
                  </td>
                  <td width="10%">
                    <p>Edit</p>
                  </td>
                  <td>
                    <p class="bCity"></p>
                  </td>
                  <td>
                    <p class="bStatus"></p>
                  </td>
                  <td>
                    <p class="bLastVisit"></p>
                  </td>
                  <td>
                    <p class="bNextVisit"></p>
                  </td>
                </tr>
                <tr>
                  <td width="80%">
                    <p class="bName"></p>
                  </td>
                  <td width="20%">
                  </td>
                  <td>
                    <p class="bCity"></p>
                  </td>
                  <td>
                    <p class="bStatus"></p>
                  </td>
                  <td>
                    <p class="bLastVisit"></p>
                  </td>
                  <td>
                    <p class="bNextVisit"></p>
                  </td>
                </tr>
                <tr>
                  <td width="80%">
                    <p class="bName"></p>
                  </td>
                  <td width="20%">
                  </td>
                  <td>
                    <p class="bCity"></p>
                  </td>
                  <td>
                    <p class="bStatus"></p>
                  </td>
                  <td>
                    <p class="bLastVisit"></p>
                  </td>
                  <td>
                    <p class="bNextVisit"></p>
                  </td>
                </tr>
                <tr>
                  <td width="80%">
                    <p class="bName"></p>
                  </td>
                  <td width="20%">
                  </td>
                  <td>
                    <p class="bCity"></p>
                  </td>
                  <td>
                    <p class="bStatus"></p>
                  </td>
                  <td>
                    <p class="bLastVisit"></p>
                  </td>
                  <td>
                    <p class="bNextVisit"></p>
                  </td>
                </tr>
                <tr>
                  <td width="80%">
                    <p class="bName"></p>
                  </td>
                  <td width="20%">
                  </td>
                  <td>
                    <p class="bCity"></p>
                  </td>
                  <td>
                    <p class="bStatus"></p>
                  </td>
                  <td>
                    <p class="bLastVisit"></p>
                  </td>
                  <td>
                    <p class="bNextVisit"></p>
                  </td>
                </tr>
                <tr>
                  <td width="80%">
                    <p class="bName"></p>
                  </td>
                  <td width="20%">
                  </td>
                  <td>
                    <p class="bCity"></p>
                  </td>
                  <td>
                    <p class="bStatus"></p>
                  </td>
                  <td>
                    <p class="bLastVisit"></p>
                  </td>
                  <td>
                    <p class="bNextVisit"></p>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Links for Pagination -->
        <!-- Basic style to make the list of page indexes appear inline -->
        <style>
        .paginationLinks li { display: inline;}
        </style>

        <div class="small-4 push-4 columns">
            <ul class="paginationLinks">
              <li><button class="button tiny"> < </button></li>
              <li><a href="#">1</a></li>
              <li><a href="#">2</a></li>
              <li><a href="#">3</a></li>
              <li><button class="button tiny"> > </button></li>
            </ul>
          
        </div>

      </div>
    </div>
    
    <script src="js/vendor/jquery.js"></script>
    <script src="js/foundation.min.js"></script>
    <script>
      $(document).foundation();
      var objectCount = 0;
      $.ajax({
          url: "getBusinessInfo.php",
          type: "GET",
          dataType: "json",
          success: function (incomingJson) {
            //console.log(incomingJson);
            window.localStorage.setItem('businessInfo' ,JSON.stringify(incomingJson));
            populateInfo(incomingJson);
            
          },
          error: function(response) {
              console.log(response);
              console.log('Test failed!');                  
          }
      });       

      function populateInfo(incomingJson){
        //console.log(incomingJson);
        var i = 0;
        for(a in incomingJson){
          objectCount++;
          jsonInfo = incomingJson[a];
          var j = i + 1;
          //console.log(jsonInfo);
          $('.bDetails:eq('+i+')').attr("onclick", 'location.href="screen3.html?storeID='+a+'"');
          $('.bName:eq('+i+')').html(jsonInfo['bName']);
          $('.bCity:eq('+i+')').html(jsonInfo['bCity']);
          $('.bLastVisit:eq('+i+')').html(jsonInfo['bLastVisit']);
          $('.bNextVisit:eq('+i+')').html(jsonInfo['bNextVisit']);
          $('.bStatus:eq('+i+')').html(jsonInfo['bStatus']);
          i++;
        }
      }

      function repopulate(classifier){
        //console.log(classifier);
        incomingJson = JSON.parse( window.localStorage['businessInfo'] );

        var newArray = [];

        for (a in incomingJson){
          //console.log(incomingJson[a]);
          newArray.push(incomingJson[a]);
        }

        /* Sort by Business Name */
        newArray.sort(function (a,b) {

          if ( a[classifier].toLowerCase() > b[classifier].toLowerCase() ) return  1;
          if ( a[classifier].toLowerCase() < b[classifier].toLowerCase() ) return -1;
          /*if (a[2] > b[2]) return  1;
          if (a[2] < b[2]) return -1;*/
          return 0;
        });
        
        var i = 0;
        for(a in newArray){
          objectCount++;
          jsonInfo = newArray[a];
          var j = i + 1;
          //console.log(jsonInfo);
          $('.bCheckbox:eq('+i+')').attr("value",a);
          $('tr:eq('+j+')').attr("onclick", 'location.href="screen3.html?storeID='+a+'"');
          $('.bName:eq('+i+')').html(jsonInfo['bName']);
          //console.log(jsonInfo['bName']);
          $('.bAddress:eq('+i+')').html(jsonInfo['bAddress']);
          $('.bAddress2:eq('+i+')').html(jsonInfo['bAddress2']);
          $('.bLastVisit:eq('+i+')').html(jsonInfo['bLastVisit']);
          $('.bNextVisit:eq('+i+')').html(jsonInfo['bNextVisit']);
          $('.bStatus:eq('+i+')').html(jsonInfo['bStatus']);
          i++;
        }

      }

      function sendQR(){
        var checkArray = [];
        for (i=0;i<objectCount;i++){ 
          if( $('.bCheckbox:eq('+i+'):checked').val()?true:false ){
            checkArray.push( $('.bCheckbox:eq('+i+')').val() );
          }
        }

        console.log(checkArray);

        $.ajax({
            url: "printQR.php",
            type: "POST",
            data:  { 'QRToPrint': checkArray },
            dataType: "json",
            success: function (jsonStr) {
                console.log(jsonStr);
            },
            error: function(response) {
                console.log(response);
                console.log('Test failed!');                  
            }
        }); 
      }


    </script>
  </body>
</html>
